<%= render "shared/header" %>
<div class="hero bg-base-200">
  <div class="w-screen px-4 my-12 max-w-xl">
    <div class="card bg-base-100 shadow-xl">
      <figure>
        <img src="https://www.yukimi-corp.com/image/Company_index.jpg" alt="幸美商事" />
      </figure>
      <div class="card-body">
        <h2 class="card-title"><%= @user.name %>さんの登録情報</h2>
        <p>下記編集ボタンから、登録情報の更新が行えます。</p>
        <div class="card-actions justify-end">
          <%= link_to "編集", edit_admins_user_path(@user), class: "btn btn-primary" %>
        </div>
      </div>
    </div>
    <div class="overflow-x-auto bg-base-100 shadow-xl p-2 mt-5 mb-3 rounded-lg">
      <div class="p-3 flex items-center justify-between">
        <h2 class="text-lg font-bold">稼働している点呼</h2>
        <%= link_to "点呼追加", new_admins_user_alarm_path(@user), class: "btn btn-primary" %>
      </div>
      <% if @alarms.present? %>
        <% @alarms.each do |alarm| %>
          <details class="group border border-gray-300 rounded-lg mb-2">
            <summary class="cursor-pointer bg-gray-100 p-3 rounded-t-lg group-open:bg-gray-200">
              <%= alarm.time.strftime("%H:%M") %> <%= alarm.enabled? ? "点呼ON": "点呼OFF" %>
            </summary>
            <div class="p-3 bg-gray-50 group-open:bg-white rounded-b-lg">
              <p><%= alarm.title.present? ? alarm.title : "タイトルなし" %></p>
              <!-- 通知曜日の表示 -->
              <p>通知する曜日:
                <% days = [] %>
                <% days << "月曜" if alarm.monday %>
                <% days << "火曜" if alarm.tuesday %>
                <% days << "水曜" if alarm.wednesday %>
                <% days << "木曜" if alarm.thursday %>
                <% days << "金曜" if alarm.friday %>
                <% days << "土曜" if alarm.saturday %>
                <% days << "日曜" if alarm.sunday %>
                <% if alarm.everyday %>
                  毎日
                <% elsif days.any? %>
                  <%= days.join(", ") %>
                <% else %>
                  設定なし
                <% end %>
              </p>

              <!-- 通知方法の表示 -->
              <p>通知方法:
                <%= alarm.email ? "メール" : "" %>
                <%= alarm.line ? (alarm.email ? "、" : "") + "LINE" : "" %>
                <% if !alarm.email && !alarm.line %>
                  設定なし
                <% end %>
              </p>

              <!-- 点呼のオン/オフボタン -->
              <div class="mt-4">
                <% if alarm.enabled? %>
                  <%= link_to "点呼をオフにする", api_user_alarm_path(alarm.user, alarm, enabled: false), data: {turbo_method: :patch}, class: "btn btn-outline btn-sm" %>
                <% else %>
                  <%= link_to "点呼をオンにする", api_user_alarm_path(alarm.user, alarm, enabled: true), data: {turbo_method: :patch}, class: "btn btn-outline btn-sm" %>
                <% end %>
              </div>

              <!-- 編集ボタン -->
              <div class="mt-2">
                <%= link_to "編集", edit_admins_user_alarm_path(alarm.user, alarm), class: "btn btn-primary btn-sm" %>
              </div>
            </div>
          </details>
        <% end %>
      <% end %>
    </div>
  </div>
</div>

<%= render "shared/footer" %>